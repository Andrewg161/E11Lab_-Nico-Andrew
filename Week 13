import pandas as pd
import matplotlib.pyplot as plt
from datetime import timedelta
import numpy as np
df = pd.read_csv("Spectrum_Loc1_session1_group1_2025-04-11_16-51-13 (1).csv")
#A
# Couldnt get temperature and 2.5 PM concentration sensors to work so only able to do
# the radiation data. Also couldn't get location to work so had to split manually. 
df = pd.read_csv("Spectrum_Loc1_session1_group1_2025-04-11_16-51-13 (1).csv")
df['Total_Counts'] = df['1023']

locations = {
    "Hearst Ave": df.iloc[0:54].copy(),
    "Glade": df.iloc[54:108].copy(),
    "Yali's": df.iloc[108:163].copy()}

for loc_data in locations.values():
    loc_data['Elapsed_Minutes'] = [i * 5 / 60 for i in range(len(loc_data))]
    loc_data['Relative_Counts'] = loc_data['Total_Counts'] - loc_data['Total_Counts'].iloc[0]

fig, axes = plt.subplots(3, 1, figsize=(12, 10), sharex=False)
for ax, (location, data) in zip(axes, locations.items()):
    ax.plot(data['Elapsed_Minutes'], data['Relative_Counts'], marker='o', linestyle='-')
    ax.set_title(f"Relative Radiation Counts Over Time - {location}")
    ax.set_xlabel("Run Time (minutes)")
    ax.set_ylabel("Relative Counts (from start)")
    ax.grid()

plt.tight_layout()
plt.show()
#B
fig, axes = plt.subplots(3, 1, figsize=(10, 12))

for ax, (location, data) in zip(axes, locations.items()):
    relative_counts = data['Total_Counts'] - data['Total_Counts'].iloc[0]
    mean_rel = relative_counts.mean()
    std_rel = relative_counts.std()

    ax.hist(relative_counts, bins=15, edgecolor='black', alpha=0.7)
    ax.axvline(mean_rel, color='red', label=f'Mean = {mean_rel:.2f}')
    ax.axvline(mean_rel + std_rel, color='green', label=f'+1σ = {mean_rel + std_rel:.2f}')
    ax.axvline(mean_rel - std_rel, color='green', label=f'-1σ = {mean_rel - std_rel:.2f}')
    ax.set_title(f"Histogram of Relative Counts - {location}")
    ax.set_xlabel("Relative Counts (from location start)")
    ax.set_ylabel("Frequency")
    ax.legend()
    ax.grid()

plt.tight_layout()
plt.show()
#C
for location, data in locations.items():
    relative_counts = data['Total_Counts'] - data['Total_Counts'].iloc[0]

    mean_rel = relative_counts.mean()
    expected_std = np.sqrt(mean_rel)
    measured_std = relative_counts.std()

    print(location)
    print("Mean of relative counts:", mean_rel)
    print("Expected σ:", expected_std)
    print("Measured σ:", measured_std)
#D
for location, data in locations.items():
    relative_counts = data['Total_Counts'] - data['Total_Counts'].iloc[0]
    
    measured_std = relative_counts.std()
    N = len(relative_counts)
    uncertainty_sigma = measured_std / np.sqrt(2 * N)

    print(location)
    print("Measured σ:", measured_std)
    print("Uncertainty on σ from CLT: +-", uncertainty_sigma)
#E
# Yes, the measured variation in radiation counts was significantly greater than the expected
# variation from simple counting statistics. This suggests that additional sources of radiation
# or environmental factors, such as changes in location or shielding, contributed to the observed data.
#F
# The mean relative radiation counts at each location differ by amounts much larger than their
# uncertainties, indicating statistically significant differences between locations. However, 
# these differences remain small in absolute terms and would not result in meaningful differences
# in radiation dose that could impact human health.
